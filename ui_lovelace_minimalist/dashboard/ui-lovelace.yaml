button_card_templates: !include_dir_merge_named "../../custom_components/ui_lovelace_minimalist/lovelace/ulm_templates/"
title: "Luxpower Solar Dashboard"
theme: "minimalist-desktop"
background: "var(--background-image)"
views:
  - title: "Home"
    path: "home"
    icon: "mdi:home"
    cards:
      #######################################################
      # MAIN ENERGY FLOW VISUALIZATION
      #######################################################

      # Card-mod styled card to create a visual power flow
      - type: picture-elements
        image: /local/images/energy_background.png  # Create a simple transparent PNG
        card_mod:
          style: |
            ha-card {
              background: rgba(0,0,0,0.2);
              border-radius: 15px;
              padding: 15px;
              height: 250px;
            }
        elements:
          # Solar Panel Icon and Value
          - type: icon
            icon: mdi:solar-panel
            style:
              top: 15%
              left: 25%
              color: '#FFD700'
              '--mdc-icon-size': 40px
          - type: state-label
            entity: sensor.luxpower_lxp_pv_power
            style:
              top: 30%
              left: 25%
              color: white
              font-size: 18px
              font-weight: bold
          
          # Home Icon and Value
          - type: icon
            icon: mdi:home
            style:
              top: 15%
              left: 75%
              color: '#4682B4'
              '--mdc-icon-size': 40px
          - type: state-label
            entity: sensor.luxpower_lxp_load_power
            style:
              top: 30%
              left: 75%
              color: white
              font-size: 18px
              font-weight: bold
          
          # Battery Icon and Value
          - type: icon
            icon: mdi:battery
            style:
              top: 70%
              left: 50%
              color: '#50C878'
              '--mdc-icon-size': 40px
          - type: state-label
            entity: sensor.luxpower_lxp_battery_power
            style:
              top: 85%
              left: 50%
              color: white
              font-size: 18px
              font-weight: bold
          
          # Battery Percentage
          - type: state-label
            entity: sensor.luxpower_lxp_battery_state_of_charge
            suffix: "%"
            style:
              top: 95%
              left: 50%
              color: white
              font-size: 16px
              
          # Flow arrows
          - type: custom:state-icon
            entity: sensor.luxpower_lxp_pv_power
            icon: mdi:arrow-right
            style:
              top: 15%
              left: 50%
              transform: rotate(0deg)
              color: '#FFD700'
              '--mdc-icon-size': 30px
              opacity: |
                [[[  
                  return states['sensor.luxpower_lxp_pv_power'].state > 0 ? '1' : '0';
                ]]]
                
          - type: custom:state-icon
            entity: sensor.luxpower_lxp_battery_power
            icon: mdi:arrow-up
            style:
              top: 50%
              left: 50%
              transform: |
                [[[  
                  return states['sensor.luxpower_lxp_battery_power'].state < 0 ? 'rotate(0deg)' : 'rotate(180deg)';
                ]]]
              color: '#50C878'
              '--mdc-icon-size': 30px
              
      #######################################################
      # BATTERY STATUS CARD
      #######################################################
      
      # Energy Gauge Bundle Card for Battery
      - type: custom:energy-gauge-bundle-card
        entity: sensor.luxpower_lxp_battery_state_of_charge
        name: Battery Storage
        unit: "%"
        min: 0
        max: 100
        severity:
          green: 50
          yellow: 20
          red: 0
        complementary:
          - entity: sensor.luxpower_lxp_battery_power
            name: Current Power
            unit: "W"
            icon: mdi:flash
          - entity: sensor.luxpower_lxp_pv_energy
            name: Today's Solar
            unit: "kWh"
            icon: mdi:solar-power
            
      #######################################################
      # POWER FLOW CHART
      #######################################################
      
      # ApexCharts Card for Power Flow Comparison
      - type: custom:apexcharts-card
        header:
          show: true
          title: Power Flow
          show_states: true
        graph_span: 6h
        span:
          start: hour
        apex_config:
          chart:
            height: 250
          yaxis:
            title:
              text: 'Watts'
        series:
          - entity: sensor.luxpower_lxp_pv_power
            name: Solar Generation
            stroke_width: 2
            color: '#FFD700'
            group_by:
              func: avg
              duration: 5m
          - entity: sensor.luxpower_lxp_load_power
            name: Home Consumption
            stroke_width: 2
            color: '#FF6347'
            group_by:
              func: avg
              duration: 5m
          - entity: sensor.luxpower_lxp_battery_power
            name: Battery Power
            stroke_width: 2
            color: '#4682B4'
            group_by:
              func: avg
              duration: 5m